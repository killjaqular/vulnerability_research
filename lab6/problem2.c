/*
Use the necessary tools to perform analysis of the compiled source code generated. Since we
are working in 32-bit use “-m32” for your gcc compilation options. For compilation I would
suggest using compiler option “-fno-stack-protector” and “-z execstack”. Please submit
write-ups of your analysis. Your points will be based on completeness of analysis, your
understanding of the problems, and if you were able to achieve the goals.

To compile:
gcc -m32 -fno-stack-protector -z execstack problem2.c -o problem2

Problem 2: 10pts
Create your own CFD to the function pass

In Kali, in GDB, pass is at: 0x565561f8
\xf8\x61\x55\x56
*/

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>

struct userProfile{
    char username[64]; //64 bytes
    char password[64]; //64 bytes
};

struct functionCaller{
    int (*functionCaller)(); //12 bytes
};

int fail(){
    printf("\nfail!!!\n");
}

void pass(){
    printf("\npass!!!\n");
}

int main(int argc, char** argv){
    struct userProfile *d; //4
    struct functionCaller *f; //4

    d = malloc(sizeof(struct userProfile)); //4 previous, 4 size, 128 payload
    f = malloc(sizeof(struct functionCaller)); //4 previous, 4 size, 12 payload
    f->functionCaller = fail;

    strcpy(d->username, argv[1]);

    f->functionCaller();

    return 0;
}
