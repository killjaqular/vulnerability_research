/*
Adonay Pichardo, adonaypichardo@gmail.com

@description
Assignment 2 of 2022 Spring Vulnerability Research at Florida Tech.

Problem 4:
Create, compile, and analyze your own buffer overflow example.

1. Explain the scenarios that your code is vulnerable to the overflow.
    Into the buffer input, you can override the values of access and flag. This is due to
    the insecure nature of gets(). gets() does not stop reading until a '\n' char is read
    somewhere in the stream being read. Filling buffer with more than 8 chars, say 10
    chars, will set access and flag to be greater than 0.

2. Provide an example of how to cause the overflow.
    user@host#:_>./problem4
    user@host#:_>Password:_> abcdefghijklm
    "abcdefgh" will be placed into the 8 chars reserved in input. All values after that
    will begin being written into first, flag, and then access variables.

3. What would be the best way to mitigate the vulnerability?
    1. Do not use gets(). Use fgets() instead. In fgets(), you must specific how many
    bytes to read from a stream.

    2. Compilers should have stack canaries enable by default. A Stack canary can prevent
    writting into the stack and hijacking the flow fo the program by writing addresses to
    jump to into RIP.

*/

#include <stdio.h>
#include <stdbool.h>

bool validateInput(char*);

int main(void){
    int access = 0;
    int flag   = 0;
    char input[8];

    printf("Password:_> ");
    gets(input);

    flag = validateInput(input);

    printf("Using credentials:_> input=%s, flag=%d, access=%d",
           input, flag, access);

    if(flag && access){
        printf("Welcome!\n");

    }else{
        printf("Denied!!\n");
    }

    return 0;
}

bool validateInput(char* input){
    return (int) input[10];
}
